# üê≥ Docker –¥–ª—è UTM Connect Backend

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Docker –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ production.

## üìã –ß—Ç–æ —Ç–∞–∫–æ–µ Docker?

Docker ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –ª—é–±–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Mac, Windows, Linux)
- ‚úÖ –ò–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º PostgreSQL
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ë–î
- ‚úÖ –õ–µ–≥–∫–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, –∫—Ä–æ–º–µ Docker

**–ë–µ–∑ Docker:**
```
–ú–æ–π Mac: Node.js v18, PostgreSQL 14, Python 3.9...
–¢–≤–æ–π Mac: Node.js v16, PostgreSQL 12, Python 3.11...
–°–µ—Ä–≤–µ—Ä: Node.js v20, PostgreSQL 16...
–ö–û–ù–§–õ–ò–ö–¢–´! üò±
```

**–° Docker:**
```
–í—Å—ë –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö! üéâ
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏ Docker Desktop

**macOS:**
```bash
# –ß–µ—Ä–µ–∑ Homebrew
brew install --cask docker

# –ò–õ–ò —Å–∫–∞—á–∞–π —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞
# https://www.docker.com/products/docker-desktop
```

**–ü—Ä–æ–≤–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∫—É:**
```bash
docker --version
# Docker version 24.x.x...

docker-compose --version
# Docker Compose version 2.x.x...
```

### 2. –°–∫–æ–ø–∏—Ä—É–π `.env` —Ñ–∞–π–ª

```bash
cp .env.example .env
```

–§–∞–π–ª `.env` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è Docker.

### 3. –ó–∞–ø—É—Å—Ç–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏ PostgreSQL + PgAdmin
docker-compose up -d

# -d –æ–∑–Ω–∞—á–∞–µ—Ç "–≤ —Ñ–æ–Ω–µ" (detached mode)
# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã –≤ —Ñ–æ–Ω–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úî Container utm_connect_db      Started
‚úî Container utm_connect_pgadmin  Started
```

### 4. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å

```bash
docker-compose ps

# CONTAINER ID   IMAGE              STATUS
# abc123def456   postgres:16-alpine Up 2 minutes
# xyz789uvw012   dpage/pgadmin4     Up 2 minutes
```

### 5. –°–æ–∑–¥–∞–π –∏ –ø—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Prisma Client
npm run prisma:generate

# –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
npm run prisma:migrate
# ‚Üí –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏: init
```

### 6. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (–Ω–µ –≤ Docker)
npm run dev

# –ò–ª–∏ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose up app
```

### 7. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É

```bash
# Health check
curl http://localhost:3000/health
# { "status": "ok" }

# –ü–æ–ø—Ä–æ–±—É–π —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","name":"Test User","password":"123456"}'
```

---

## üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ `docker-compose up -d` —É —Ç–µ–±—è –±—É–¥—É—Ç:

| –°–µ—Ä–≤–∏—Å | URL | –õ–æ–≥–∏–Ω | –ü–∞—Ä–æ–ª—å | –î–ª—è —á–µ–≥–æ |
|--------|-----|-------|--------|----------|
| **PostgreSQL** | `localhost:5432` | postgres | postgres | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **PgAdmin** | `http://localhost:5050` | admin@example.com | admin | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î —á–µ—Ä–µ–∑ –≤–µ–± |

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ PgAdmin –∫ PostgreSQL

1. –û—Ç–∫—Ä–æ–π `http://localhost:5050` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í–≤–µ–¥–∏ –ª–æ–≥–∏–Ω: `admin@example.com` –ø–∞—Ä–æ–ª—å: `admin`
3. –ú–µ–Ω—é ‚Üí **Servers** ‚Üí **Register** ‚Üí **Server**
4. **–í–∫–ª–∞–¥–∫–∞ "General":**
   - Name: `utm_connect`
5. **–í–∫–ª–∞–¥–∫–∞ "Connection":**
   - Host name/address: `postgres` (–∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Å–µ—Ç–∏ Docker)
   - Port: `5432`
   - Username: `postgres`
   - Password: `postgres`
6. Click **Save**

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≤–∏–¥–∏—à—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ PgAdmin. üéâ

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ Docker

### `docker-compose.yml` ‚Äî –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤

```yaml
version: '3.8'

services:
  postgres:  # ‚Üê –°–µ—Ä–≤–∏—Å 1: PostgreSQL
    image: postgres:16-alpine
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    
  pgadmin:   # ‚Üê –°–µ—Ä–≤–∏—Å 2: PgAdmin (–≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
    image: dpage/pgadmin4:latest
    ports:
      - "5050:80"
    depends_on:
      postgres:
        condition: service_healthy

volumes:    # ‚Üê –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏)
  postgres_data:

networks:   # ‚Üê –°–µ—Ç—å –¥–ª—è –æ–±—â–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  utm_network:
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. **Services** - —ç—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
2. **Ports** - –º–∞–ø–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤ (HOST:CONTAINER)
3. **Volumes** - –≥–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ
4. **Networks** - –∫–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π
5. **Depends_on** - –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ (PgAdmin –∂–¥—ë—Ç PostgreSQL)

### `Dockerfile` ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```dockerfile
FROM node:18-alpine  # ‚Üê –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (OS + Node.js)

WORKDIR /app         # ‚Üê –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

COPY package*.json . # ‚Üê –ö–æ–ø–∏—Ä—É–µ–º package.json
RUN npm ci           # ‚Üê –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

COPY . .             # ‚Üê –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
RUN npm run build    # ‚Üê –°–æ–±–∏—Ä–∞–µ–º TypeScript

EXPOSE 3000          # ‚Üê –ö–∞–∫–æ–π –ø–æ—Ä—Ç —Å–ª—É—à–∞—Ç—å

CMD ["node", "dist/index.js"]  # ‚Üê –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```

---

## üîß –ö–æ–º–∞–Ω–¥—ã Docker

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f postgres
docker-compose logs -f pgadmin

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose restart

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes (–û–°–¢–û–†–û–ñ–ù–û! –ü–æ—Ç–µ—Ä—è–µ—à—å –¥–∞–Ω–Ω—ã–µ)
docker-compose down -v
```

### –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

```bash
# –ó–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ PostgreSQL
docker-compose exec postgres psql -U postgres -d utm_connect

# SQL –∑–∞–ø—Ä–æ—Å—ã –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec postgres psql -U postgres -d utm_connect -c "SELECT * FROM \"User\";"

# –ó–∞–π—Ç–∏ –≤ bash –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose exec app /bin/sh
```

### –†–∞–±–æ—Ç–∞ —Å –æ–±—Ä–∞–∑–∞–º–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—Ä–∞–∑–æ–≤
docker images

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑
docker rmi postgres:16-alpine

# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë (–û–°–¢–û–†–û–ñ–ù–û!)
docker system prune -a
```

---

## üê≥ –ü–æ–ª–Ω—ã–π workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# –°–∫–æ–ø–∏—Ä—É–π .env
cp .env.example .env

# –ó–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# –ñ–¥—ë–º 10 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ PostgreSQL —Å—Ç–∞—Ä—Ç—É–µ—Ç
sleep 10

# –°–æ–∑–¥–∞–π –ë–î –∏ –ø—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run prisma:generate
npm run prisma:migrate

# –ó–∞–ø–æ–ª–Ω–∏ –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
npm run seed

# –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
npm run dev
```

### 2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ
docker-compose up -d

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î
npm run prisma:migrate

# –í –∫–æ–Ω—Ü–µ –¥–Ω—è
docker-compose down
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```bash
# –û—Ç–∫—Ä–æ–π PgAdmin
# http://localhost:5050

# –ò–õ–ò —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
docker-compose exec postgres psql -U postgres -d utm_connect

# –í psql:
# \dt                    # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
# \d "User"              # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã User
# SELECT * FROM "User";  # –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
# \q                     # –í—ã—Ö–æ–¥
```

---

## üöÄ Production Dockerfile

–î–ª—è production —Ö–æ—Å—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Dockerfile.

–¢–µ–∫—É—â–∏–π `Dockerfile` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- ‚úÖ Multi-stage build (–º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞)
- ‚úÖ Alpine Linux (—Å–∞–º—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –æ–±—Ä–∞–∑)
- ‚úÖ Health checks (Docker –∑–Ω–∞–µ—Ç –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ)
- ‚úÖ Production dependencies only

**–†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞:**
```bash
docker build -t utm-connect .
docker images utm-connect

# REPOSITORY    TAG    SIZE
# utm-connect   latest 180MB (muito –∫–æ–º–ø–∞–∫—Ç–Ω–æ!)
```

---

## üìä –ö–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Docker Network: utm_network     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇ   postgres       ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ  (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)   ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ  port: 5432      ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ         ‚Üë                               ‚îÇ
‚îÇ         ‚îÇ (–æ–±—â–∞–µ—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏ "postgres")‚îÇ
‚îÇ         ‚îÇ                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇ      app         ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ   (Node.js)      ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ  port: 3000      ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ         ‚Üë                               ‚îÇ
‚îÇ         ‚îÇ (–ø–æ—Ä—Ç –º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ localhost)  ‚îÇ
‚îÇ         ‚îÇ                               ‚îÇ
‚îÇ    http://localhost:3000                ‚îÇ
‚îÇ    (–¥–æ—Å—Ç—É–ø–Ω–æ —Å —Ç–≤–æ–µ–≥–æ Mac)              ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇ     pgadmin      ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ   (–≤–µ–± UI)       ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ  port: 80        ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ         ‚Üë                               ‚îÇ
‚îÇ         ‚îÇ                               ‚îÇ
‚îÇ    http://localhost:5050                ‚îÇ
‚îÇ    (–¥–æ—Å—Ç—É–ø–Ω–æ —Å —Ç–≤–æ–µ–≥–æ Mac)              ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–ª—é—á–µ–≤–æ–µ:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è –ø–æ –∏–º–µ–Ω–∞–º:
- `postgres` –∑–Ω–∞–µ—Ç –∫–∞–∫ –¥–æ—Å—Ç–∏—á—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä postgres
- `app` –∑–Ω–∞–µ—Ç –∫–∞–∫ –¥–æ—Å—Ç–∏—á—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä postgres
- –ù–æ —Å–Ω–∞—Ä—É–∂–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `localhost`

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ Production

**‚ö†Ô∏è –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ –ø–∞—Ä–æ–ª–∏ –≤ production!**

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ –±–æ–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä:

1. **–ò–∑–º–µ–Ω–∏ –ø–∞—Ä–æ–ª–∏ –≤ `.env`:**
   ```
   DB_USER="utm_connect_user"
   DB_PASSWORD="super-strong-password-32-chars-min"
   PGADMIN_PASSWORD="another-strong-pass"
   JWT_SECRET="long-random-secret-for-jwt"
   ```

2. **–ù–µ expose PostgreSQL –ø–æ—Ä—Ç–∞ –≤ production:**
   ```yaml
   # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (production)
   postgres:
     ports:
       - "5432:5432"  # –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö!
   
   # ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (production)
   postgres:
     # –ë–µ–∑ ports! –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ app –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   ```

3. **–û—Ç–∫–ª—é—á–∏ PgAdmin –≤ production:**
   ```yaml
   pgadmin:
     # –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!
   ```

---

## üÜò Troubleshooting

### PostgreSQL –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

```bash
# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏
docker-compose logs postgres

# –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ—Ä—Ç–æ–º
# –£–±–µ–¥–∏—Å—å —á—Ç–æ –Ω–∞ –ø–æ—Ä—Ç—É 5432 –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª—É—à–∞–µ—Ç
lsof -i :5432

# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª—É—à–∞–µ—Ç, —É–±–µ–π –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>
```

### –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker-compose ps

# –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ã—à–µ–ª —Å –æ—à–∏–±–∫–æ–π:
docker-compose logs postgres

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏
docker-compose down -v
docker-compose up -d
sleep 10  # –ñ–¥–∏ –ø–æ–∫–∞ PostgreSQL –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
```

### –ü–æ—Ç–µ—Ä—è–ª –¥–∞–Ω–Ω—ã–µ

```bash
# –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –µ—Å–ª–∏ —É–¥–∞–ª–∏–ª volume, –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã
# –ù–æ –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup (–µ—Å–ª–∏ –µ—Å—Ç—å)

# –ù–∞ –±—É–¥—É—â–µ–µ: —Ä–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π backups
docker-compose exec postgres pg_dump -U postgres utm_connect > backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
docker-compose exec -T postgres psql -U postgres utm_connect < backup.sql
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤–∏–¥–∏—Ç –ë–î

**–ü—Ä–æ–≤–µ—Ä—å DATABASE_URL –≤ `.env`:**

```
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–Ω–∞ —Ç–≤–æ—ë–º Mac)
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/utm_connect"

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å app –≤ Docker)
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/utm_connect"

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–µ—Å–ª–∏ app –≤ Docker)
DATABASE_URL="postgresql://postgres:postgres@postgres:5432/utm_connect"
# "postgres" - –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Å–µ—Ç–∏ Docker
```

---

## üìù –¢–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞: PgAdmin –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

```
"Could not connect to the specified database"
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞ –≤ PgAdmin

**–†–µ—à–µ–Ω–∏–µ:**
- Host name: `postgres` (–ù–ï localhost!)
- Port: `5432`
- Username: `postgres`
- Password: `postgres`

---

## üéØ Deployment –Ω–∞ Production —Å–µ—Ä–≤–µ—Ä

–ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤ –∫ production:

1. **–°–∫–æ–ø–∏—Ä—É–π `docker-compose.yml` –∏ `Dockerfile` –Ω–∞ —Å–µ—Ä–≤–µ—Ä**

2. **–°–æ–∑–¥–∞–π `.env` —Å production –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:**
   ```
   DB_USER="utm_secure_user"
   DB_PASSWORD="$(openssl rand -base64 32)"
   PGADMIN_PASSWORD="disable"  # –û—Ç–∫–ª—é—á–∏ –≤ production
   JWT_SECRET="$(openssl rand -base64 32)"
   ```

3. **–ó–∞–ø—É—Å—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   docker-compose up -d
   docker-compose exec app npm run prisma:migrate -- --skip-generate
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (Nginx/Caddy):**
   ```nginx
   server {
       listen 80;
       server_name utm-connect.com;
       
       location / {
           proxy_pass http://localhost:3000;
       }
   }
   ```

---

## ÔøΩÔ∏è Makefile - –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è Docker

–ß—Ç–æ–±—ã –Ω–µ –ø–æ–º–Ω–∏—Ç—å –≤—Å–µ Docker –∫–æ–º–∞–Ω–¥—ã, —Å–æ–∑–¥–∞–Ω `Makefile` —Å —É–¥–æ–±–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –î–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–µ–ª–∞–µ—Ç –≤—Å—ë!
make setup

# –≠—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:
# 1. npm install
# 2. cp .env.example .env
# 3. docker-compose up -d
# 4. npm run prisma:migrate
# 5. npm run seed
```

### üê≥ Docker –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Makefile

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (PostgreSQL + PgAdmin)
make docker-up

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make docker-down

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make docker-restart

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make docker-logs

# –°–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏ PostgreSQL
make docker-logs-db

# –°–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏ PgAdmin
make docker-logs-pgadmin

# –°–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make docker-ps

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –¥–∞–Ω–Ω—ã–µ (–û–°–¢–û–†–û–ñ–ù–û!)
make docker-clean
```

### üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Makefile

```bash
# –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make db-migrate

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
make db-seed

# –û—Ç–∫—Ä—ã—Ç—å PostgreSQL –∫–æ–Ω—Å–æ–ª—å
make db-shell

# –°–æ–∑–¥–∞—Ç—å backup –ë–î
make db-backup

# –°–±—Ä–æ—Å–∏—Ç—å –ë–î (WARNING: —É–¥–∞–ª–∏—Ç –≤—Å—ë!)
make db-reset

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client
make db-generate
```

### üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Makefile

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
make dev

# –°–æ–±—Ä–∞—Ç—å production bundle
make build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å production —Å–µ—Ä–≤–µ—Ä
make start

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
make install
```

### üßπ –ö–æ–¥ –∏ –∫–∞—á–µ—Å—Ç–≤–æ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ ESLint
make lint

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å ESLint –æ—à–∏–±–∫–∏
make lint-fix

# –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ Prettier
make format

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make format-check

# –û—á–∏—Å—Ç–∏—Ç—å build –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
make clean
```

### üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Å—Ç–∞—Ç—É—Å

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ (–≤–µ—Ä—Å–∏–∏ Node, Docker –∏ —Ç.–¥.)
make info

# –°—Ç–∞—Ç—É—Å –ø–æ—Ä—Ç–æ–≤ (–æ—Ç–∫—Ä—ã—Ç—ã –ª–∏ 3000, 5432, 5050)
make status
```

### üìù –¢–∏–ø–∏—á–Ω—ã–π workflow —Å Makefile

**–î–µ–Ω—å 1 (–Ω–æ–≤—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫):**
```bash
make setup
# –í—Å—ë –≥–æ—Ç–æ–≤–æ! ‚ú®
```

**–ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ:**
```bash
make docker-up
make dev
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î:**
```bash
make db-migrate
```

**–ü–µ—Ä–µ–¥ commit:**
```bash
make lint
make format
```

**–í –∫–æ–Ω—Ü–µ –¥–Ω—è:**
```bash
make docker-down
```

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å:**
```bash
make status        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–æ
make docker-logs   # –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make docker-clean  # –ü–æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
make setup         # –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
```

### üéØ –°–∞–º—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ì–ª–∞–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ - –∑–∞–ø—É—Å—Ç–∏—Ç—å Docker
make docker-up

# –ì–ª–∞–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
make dev

# –ì–ª–∞–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ - —Ä–∞–±–æ—Ç–∞ —Å –ë–î
make db-migrate
make db-seed
make db-shell

# –ì–ª–∞–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
make help    # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make status  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.docker.com/)
- [Docker Compose –≥–∞–π–¥](https://docs.docker.com/compose/)
- [Dockerfile best practices](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
- [PostgreSQL –≤ Docker](https://hub.docker.com/_/postgres)
- [Make –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.gnu.org/software/make/manual/)

